# 修正内容のまとめ

## ✅ 修正完了

### 1. HOME画面でレビューが反映されない問題
**修正ファイル**: `screens/HomeScreen.js`
- `useFocusEffect`を使用して、画面がフォーカスされたときにデータを再取得するように修正
- レビュー投稿後にHOME画面に戻ると、評価が自動的に更新されます

### 2. 画像が表示されない問題
**修正ファイル**: 
- `screens/AddParkScreen.js`
- `screens/AddReviewScreen.js`

**修正内容**:
- `imageUploader.js`をインポート
- 画像を選択した後、Firebase Storageにアップロード
- ダウンロードURLをFirestoreに保存
- ローカルURI（`file://`）ではなく、Firebase StorageのURLを使用

**注意**: 既存の公園やレビューで、ローカルURIが保存されている場合は、画像が表示されません。新しい公園やレビューから正しく表示されます。

---

## 📋 広告について

### 現状
- **Expo Go環境では広告は表示されません**（これは正常な動作です）
- `react-native-google-mobile-ads`はネイティブモジュールのため、Expo Goでは動作しません

### 広告を表示するには
**開発ビルドまたは本番ビルドが必要です：**

```bash
# iOS開発ビルド
npx expo run:ios

# Android開発ビルド
npx expo run:android

# またはEAS Buildを使用
eas build --profile development --platform ios
```

---

## 📋 管理者ページの使用方法

詳細は `ADMIN_PAGE_GUIDE.md` を参照してください。

### 簡単な使い方
1. **アクセス**: マイページ → 「🔧 管理者ページ」ボタン
2. **レポート管理**: ユーザーから報告されたレビューを確認・対応
3. **公園管理**: 不適切な公園を削除
4. **レビュー管理**: 不適切なレビューを削除

### 管理者権限の設定
1. Firebase Consoleを開く
2. Firestore Database → `admins`コレクション
3. 新しいドキュメントを追加:
   - **ドキュメントID**: 管理者のユーザーUID
   - **フィールド**: `userId` (string) = ユーザーUID

---

## 🔄 次のステップ

### 推奨事項
1. **既存データの確認**: Firebase Consoleで、既存の公園やレビューの画像URLを確認
2. **テスト**: 新しい公園やレビューを投稿して、画像が正しく表示されるか確認
3. **開発ビルドの作成**: 広告を表示するために開発ビルドを作成

### 既存データの修正（オプション）
既存の公園やレビューで、ローカルURIが保存されている場合は、手動でFirebase Storageにアップロードする必要があります。

---

## ⚠️ 注意事項

### 画像アップロード
- **インターネット接続が必要**: 画像のアップロードにはインターネット接続が必要です
- **アップロード時間**: 画像のサイズによっては、アップロードに時間がかかる場合があります
- **エラーハンドリング**: アップロードに失敗しても、公園やレビューは保存されます（画像なし）

### データの再取得
- **自動更新**: HOME画面に戻ると、データが自動的に再取得されます
- **ネットワーク使用**: データの再取得にはインターネット接続が必要です

---

## 📞 トラブルシューティング

### 画像が表示されない
1. Firebase Consoleで、`parks`または`reviews`コレクションの`mainImage`や`images`フィールドを確認
2. URLがFirebase StorageのURL（`https://firebasestorage.googleapis.com/...`）になっているか確認
3. ローカルURI（`file://`）の場合は、新しい公園やレビューを投稿してください

### 評価が更新されない
1. Firebase Consoleで、`parks`コレクションの`rating`と`reviewCount`フィールドを確認
2. レビュー投稿後に、これらのフィールドが更新されているか確認
3. HOME画面に戻って、データが再取得されているか確認

### 広告が表示されない
- Expo Go環境では表示されません（正常な動作）
- 開発ビルドまたは本番ビルドが必要です

