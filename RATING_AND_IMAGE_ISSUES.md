# 評価と画像の問題について

## 🔍 問題1: おすすめや公園検索の画面にレビューが反映されない

### 原因の確認方法

#### 1. Firebase Consoleで確認
1. **Firebase Consoleを開く**
   - https://console.firebase.google.com/project/parkpedia-app/firestore/data
2. **`parks`コレクションを開く**
3. **公園のドキュメントを確認**
   - `rating`フィールド: 平均評価（数値、例: 4.0）
   - `reviewCount`フィールド: レビュー数（数値、例: 1）

#### 2. 確認ポイント
- **`rating`と`reviewCount`が存在するか**
- **値が正しく更新されているか**（レビュー投稿後に更新されているか）
- **データ型が正しいか**（数値型である必要があります）

### 考えられる原因

#### 原因1: `updateParkRating`が実行されていない
- レビュー投稿時にエラーが発生している可能性
- `AddReviewScreen.js`の`updateParkRating`関数が正しく呼び出されているか確認

#### 原因2: Firestoreのデータが更新されていない
- ネットワークエラーや権限エラーが発生している可能性
- Firebase Consoleで実際のデータを確認

#### 原因3: アプリが古いデータをキャッシュしている
- アプリを再起動して、最新のデータを取得

### 解決方法

#### ステップ1: Firebase Consoleで確認
1. レビューを投稿した公園の`rating`と`reviewCount`を確認
2. 値が更新されていない場合、`updateParkRating`が実行されていない可能性があります

#### ステップ2: 手動で評価を更新（一時的な解決策）
管理者ページから、該当する公園のレビューを確認し、必要に応じて手動で評価を再計算

#### ステップ3: コードを確認
`AddReviewScreen.js`の`updateParkRating`関数が正しく実装されているか確認

---

## 🖼️ 問題2: 画像が出ない

### 画像が表示されない理由

#### 既存のデータ（修正前）
- **ローカルURI**（`file://`）で保存されている
- アプリを再起動すると、ローカルURIは無効になります
- **画像は表示されません**（これはデフォルトではなく、以前の実装の名残です）

#### 新しいデータ（修正後）
- **Firebase StorageのURL**（`https://firebasestorage.googleapis.com/...`）で保存される
- インターネット接続があれば、いつでも画像を表示できます
- **画像が正しく表示されます**

### 確認方法

#### Firebase Consoleで確認
1. **`parks`コレクションを開く**
2. **公園のドキュメントを確認**
3. **`mainImage`フィールドを確認**
   - **ローカルURI**（`file:///...`）の場合: 画像は表示されません
   - **Firebase Storage URL**（`https://firebasestorage.googleapis.com/...`）の場合: 画像が表示されます

### 解決方法

#### 既存のデータの画像を修正するには
1. **新しい公園を投稿**（画像が正しく表示されます）
2. **既存の公園を編集**（画像を再アップロード）
3. **管理者ページから削除して再投稿**（推奨しません）

#### 今後の対応
- 新しい公園やレビューから、画像は正しく表示されます
- 既存のデータは、必要に応じて手動で修正してください

---

## 📋 まとめ

### 評価が反映されない場合
1. Firebase Consoleで`parks`コレクションの`rating`と`reviewCount`を確認
2. 値が更新されていない場合、`updateParkRating`が実行されていない可能性
3. アプリを再起動して、最新のデータを取得

### 画像が表示されない場合
1. Firebase Consoleで`parks`コレクションの`mainImage`を確認
2. ローカルURI（`file://`）の場合は、新しい公園を投稿してください
3. Firebase Storage URLの場合は、インターネット接続を確認

### デフォルトの動作
- **評価**: レビュー投稿時に自動的に更新されます（正常な動作）
- **画像**: 新しいデータから正しく表示されます（既存データは修正が必要）

---

## 🔧 トラブルシューティング

### 評価が更新されない
1. **Firebase Consoleで確認**: `parks`コレクションの`rating`と`reviewCount`
2. **アプリを再起動**: 最新のデータを取得
3. **ネットワーク接続を確認**: インターネット接続が必要です

### 画像が表示されない
1. **Firebase Consoleで確認**: `parks`コレクションの`mainImage`
2. **URLの形式を確認**: Firebase Storage URLかどうか
3. **新しい公園を投稿**: 画像が正しく表示されるか確認

