# é‹ç”¨è‡ªå‹•åŒ–ãƒ—ãƒ©ãƒ³

**ä½œæˆæ—¥**: 2025-12-04
**å¯¾è±¡ã‚¢ãƒ—ãƒª**: ParkPedia
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.7

---

## ç›®æ¬¡

1. [æ—¥æ¬¡ã‚¿ã‚¹ã‚¯](#æ—¥æ¬¡ã‚¿ã‚¹ã‚¯)
2. [é€±æ¬¡ã‚¿ã‚¹ã‚¯](#é€±æ¬¡ã‚¿ã‚¹ã‚¯)
3. [æœˆæ¬¡ã‚¿ã‚¹ã‚¯](#æœˆæ¬¡ã‚¿ã‚¹ã‚¯)
4. [å››åŠæœŸã‚¿ã‚¹ã‚¯](#å››åŠæœŸã‚¿ã‚¹ã‚¯)
5. [n8nè‡ªå‹•åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼](#n8nè‡ªå‹•åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼)
6. [æ‰‹å‹•å®Ÿæ–½ãŒå¿…è¦ãªã‚¿ã‚¹ã‚¯](#æ‰‹å‹•å®Ÿæ–½ãŒå¿…è¦ãªã‚¿ã‚¹ã‚¯)
7. [å®Ÿè£…ã‚¬ã‚¤ãƒ‰](#å®Ÿè£…ã‚¬ã‚¤ãƒ‰)

---

## æ—¥æ¬¡ã‚¿ã‚¹ã‚¯

### ğŸ¤– è‡ªå‹•åŒ–å¯èƒ½ï¼ˆn8nï¼‰

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | è‡ªå‹•åŒ–æ–¹æ³• | å„ªå…ˆåº¦ |
|--------|------|-----------|--------|
| **Firebaseã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç›£è¦–** | Cloud Functions/Firestoreã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç›£è¦– | n8n + Firebase Admin SDK | é«˜ |
| **ç•°å¸¸ãªã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œçŸ¥** | çŸ­æ™‚é–“ã§ã®å¤§é‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œçŸ¥ | n8n + Firestore Analytics | é«˜ |
| **AdMobåç›Šãƒ¬ãƒãƒ¼ãƒˆå–å¾—** | æ—¥æ¬¡ã®åºƒå‘Šåç›Šã‚’å–å¾—ãƒ»è¨˜éŒ² | n8n + AdMob API | ä¸­ |
| **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª** | Firebaseè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®æˆåŠŸ/å¤±æ•—ç¢ºèª | n8n + Firebase Admin API | é«˜ |

### ğŸ“ æ‰‹å‹•å®Ÿæ–½æ¨å¥¨

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | é »åº¦ | æ‰€è¦æ™‚é–“ |
|--------|------|------|---------|
| **ãƒ¬ãƒ“ãƒ¥ãƒ¼é€šå ±ã®ç¢ºèª** | æ–°ã—ã„é€šå ±ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®å†…å®¹ç¢ºèª | å–¶æ¥­æ—¥æ¯ | 5-10åˆ† |
| **App Store Connectç¢ºèª** | æ–°ã—ã„ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»å•ã„åˆã‚ã›ç¢ºèª | æ¯æ—¥ | 5åˆ† |

---

## é€±æ¬¡ã‚¿ã‚¹ã‚¯

### ğŸ¤– è‡ªå‹•åŒ–å¯èƒ½ï¼ˆn8nï¼‰

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | è‡ªå‹•åŒ–æ–¹æ³• | å„ªå…ˆåº¦ |
|--------|------|-----------|--------|
| **ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³** | `npm audit`ã®è‡ªå‹•å®Ÿè¡Œã¨ãƒ¬ãƒãƒ¼ãƒˆ | n8n + GitHub Actions | é«˜ |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ** | ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã€æ–°è¦ç™»éŒ²æ•°ãªã© | n8n + Firestore Analytics | ä¸­ |
| **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ç¢ºèª** | Firebase Storageã®ä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯ | n8n + Firebase Admin API | ä¸­ |
| **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™åé›†** | ã‚¢ãƒ—ãƒªã®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ç‡ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ | n8n + Firebase Performance | ä¸­ |

### ğŸ“ æ‰‹å‹•å®Ÿæ–½æ¨å¥¨

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | é »åº¦ | æ‰€è¦æ™‚é–“ |
|--------|------|------|---------|
| **Firebase Consoleãƒ¬ãƒ“ãƒ¥ãƒ¼** | ç•°å¸¸ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®ç¢ºèª | æ¯é€±æœˆæ›œ | 10-15åˆ† |
| **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³** | ä¸é©åˆ‡ãªå…¬åœ’æƒ…å ±ãƒ»ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ç¢ºèª | é€±1å› | 15-20åˆ† |
| **GitHub Issuesç¢ºèª** | ãƒã‚°å ±å‘Šãƒ»æ©Ÿèƒ½è¦æœ›ã®ç¢ºèª | é€±1å› | 10åˆ† |

---

## æœˆæ¬¡ã‚¿ã‚¹ã‚¯

### ğŸ¤– è‡ªå‹•åŒ–å¯èƒ½ï¼ˆn8nï¼‰

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | è‡ªå‹•åŒ–æ–¹æ³• | å„ªå…ˆåº¦ |
|--------|------|-----------|--------|
| **åŒ…æ‹¬çš„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³** | npm audit + Snyk + OWASPä¾å­˜é–¢ä¿‚ãƒã‚§ãƒƒã‚¯ | n8n + GitHub Actions | é«˜ |
| **Firebaseåˆ©ç”¨æ–™é‡‘ãƒ¬ãƒãƒ¼ãƒˆ** | æœˆæ¬¡ã®åˆ©ç”¨æ–™é‡‘ã¨äºˆæ¸¬ | n8n + Firebase Billing API | é«˜ |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ã‚²ãƒ¼ã‚¸ãƒ¡ãƒ³ãƒˆãƒ¬ãƒãƒ¼ãƒˆ** | MAUã€DAUã€ãƒªãƒ†ãƒ³ã‚·ãƒ§ãƒ³ç‡ | n8n + Firebase Analytics API | ä¸­ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–ææ¡ˆ** | æœªä½¿ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã€ã‚¯ã‚¨ãƒªæœ€é©åŒ– | n8n + ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | ä¸­ |
| **å¤ã„ãƒ‡ãƒ¼ã‚¿ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–** | 90æ—¥ä»¥ä¸Šå‰ã®å‰Šé™¤ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– | n8n + Firebase Functions | ä½ |

### ğŸ“ æ‰‹å‹•å®Ÿæ–½æ¨å¥¨

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | é »åº¦ | æ‰€è¦æ™‚é–“ |
|--------|------|------|---------|
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒé©ç”¨** | é‡è¦ãªä¾å­˜é–¢ä¿‚ã®æ›´æ–° | æœˆåˆ | 30-60åˆ† |
| **Firebase Security Rulesãƒ¬ãƒ“ãƒ¥ãƒ¼** | ãƒ«ãƒ¼ãƒ«ã®è¦‹ç›´ã—ã¨æ”¹å–„ | æ¯æœˆ | 20-30åˆ† |
| **AdMobè¨­å®šç¢ºèª** | åºƒå‘Šé…ä¿¡è¨­å®šã®æœ€é©åŒ– | æ¯æœˆ | 15åˆ† |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚µãƒãƒ¼ãƒˆåˆ†æ** | å•ã„åˆã‚ã›å‚¾å‘ã®åˆ†æ | æœˆæœ« | 30åˆ† |

---

## å››åŠæœŸã‚¿ã‚¹ã‚¯

### ğŸ¤– ä¸€éƒ¨è‡ªå‹•åŒ–å¯èƒ½

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | è‡ªå‹•åŒ–æ–¹æ³• | å„ªå…ˆåº¦ |
|--------|------|-----------|--------|
| **åŒ…æ‹¬çš„ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£æŸ»** | ã‚¢ãƒ—ãƒªå…¨ä½“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ | åŠè‡ªå‹•ï¼ˆLighthouse CIï¼‰ | é«˜ |
| **ã‚³ã‚¹ãƒˆæœ€é©åŒ–åˆ†æ** | Firebase/AWS/AdMobã®ã‚³ã‚¹ãƒˆæœ€é©åŒ– | ãƒ¬ãƒãƒ¼ãƒˆè‡ªå‹•ç”Ÿæˆ + æ‰‹å‹•åˆ†æ | é«˜ |

### ğŸ“ æ‰‹å‹•å®Ÿæ–½å¿…é ˆ

| ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | é »åº¦ | æ‰€è¦æ™‚é–“ |
|--------|------|------|---------|
| **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»** | åŒ…æ‹¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼ | å››åŠæœŸ | 2-4æ™‚é–“ |
| **æ©Ÿèƒ½ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—è¦‹ç›´ã—** | æ¬¡å››åŠæœŸã®æ©Ÿèƒ½è¨ˆç”» | å››åŠæœŸæœ« | 1-2æ™‚é–“ |
| **ç«¶åˆã‚¢ãƒ—ãƒªåˆ†æ** | é¡ä¼¼ã‚¢ãƒ—ãƒªã®èª¿æŸ»ã¨å·®åˆ¥åŒ–æˆ¦ç•¥ | å››åŠæœŸ | 1-2æ™‚é–“ |

---

## n8nè‡ªå‹•åŒ–ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### å‰ææ¡ä»¶

1. **n8nã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   # Dockerã‚’ä½¿ç”¨ï¼ˆæ¨å¥¨ï¼‰
   docker run -it --rm \
     --name n8n \
     -p 5678:5678 \
     -v ~/.n8n:/home/node/.n8n \
     n8nio/n8n
   ```

2. **å¿…è¦ãªèªè¨¼æƒ…å ±**
   - Firebase Admin SDK ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼
   - AdMob APIèªè¨¼æƒ…å ±
   - Slack Webhook URLï¼ˆé€šçŸ¥ç”¨ï¼‰
   - GitHub Personal Access Token

---

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼1: Firebase ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç›£è¦–ï¼ˆæ—¥æ¬¡ï¼‰

### ç›®çš„
Firebase Cloud Functionsã¨Firestoreã®ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’ç›£è¦–ã—ã€ç•°å¸¸ã‚’æ¤œçŸ¥ã—ãŸã‚‰å³åº§ã«é€šçŸ¥

### å®Ÿè£…

#### n8nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æˆ

```yaml
Workflow: Firebase Error Monitor
Trigger: Cron (æ¯æ—¥ 9:00 JST)

Nodes:
  1. Schedule Trigger
     - Cron: "0 9 * * *" (æ¯æ—¥9æ™‚)

  2. Firebase Admin - Get Error Logs
     - Method: GET
     - Endpoint: /v1/projects/parkpedia-app/logs
     - Filter: severity >= ERROR
     - Time range: Last 24 hours

  3. Function - Parse Logs
     - JavaScript:
       ```javascript
       const errors = $input.all();
       const criticalErrors = errors.filter(e =>
         e.severity === 'ERROR' || e.severity === 'CRITICAL'
       );

       return {
         total: errors.length,
         critical: criticalErrors.length,
         errors: criticalErrors.slice(0, 10) // ä¸Šä½10ä»¶
       };
       ```

  4. IF - Check Error Threshold
     - Condition: {{ $json.total > 10 }} OR {{ $json.critical > 0 }}

  5a. Slack Notification (IF True)
     - Webhook URL: {{ $credentials.slackWebhook }}
     - Message:
       ```
       ğŸš¨ Firebase ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥

       ç·ã‚¨ãƒ©ãƒ¼æ•°: {{ $json.total }}
       é‡å¤§ã‚¨ãƒ©ãƒ¼: {{ $json.critical }}

       è©³ç´°: Firebase Console
       ```

  5b. Email Notification (IF True)
     - To: your-email@example.com
     - Subject: "[ParkPedia] Firebase ã‚¨ãƒ©ãƒ¼æ¤œçŸ¥"
     - Body: è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆ

  6. Log to Notion/Airtable
     - æ—¥æ¬¡ãƒ­ã‚°ã¨ã—ã¦è¨˜éŒ²
```

#### æ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

1. **Firebase Admin SDKè¨­å®š**
   ```bash
   # ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
   # Firebase Console > Project Settings > Service Accounts
   ```

2. **n8nã§Credentialsè¿½åŠ **
   - Settings > Credentials > Add Credential
   - Type: Google Service Account
   - JSON Key: [è²¼ã‚Šä»˜ã‘]

3. **Slack Webhookè¨­å®š**
   - Slack Appä½œæˆ: https://api.slack.com/apps
   - Incoming Webhooksã‚’æœ‰åŠ¹åŒ–
   - Webhook URLã‚’n8nã«ç™»éŒ²

---

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼2: ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è„†å¼±æ€§ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆé€±æ¬¡ï¼‰

### ç›®çš„
é€±æ¬¡ã§ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€å•é¡ŒãŒã‚ã‚Œã°é€šçŸ¥

### å®Ÿè£…

#### n8nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æˆ

```yaml
Workflow: NPM Audit Automation
Trigger: Cron (æ¯é€±æœˆæ›œ 10:00 JST)

Nodes:
  1. Schedule Trigger
     - Cron: "0 10 * * 1" (æ¯é€±æœˆæ›œ10æ™‚)

  2. GitHub Action Trigger
     - Repository: kamui00002/ParkPedia
     - Workflow: npm-audit.yml
     - Ref: main
     - Method: workflow_dispatch

  3. Wait for Workflow Completion
     - Timeout: 5 minutes

  4. Get Workflow Results
     - GitHub API: GET /repos/kamui00002/ParkPedia/actions/runs

  5. Parse Audit Results
     - Extract: vulnerabilities count

  6. IF - Vulnerabilities Found
     - Condition: {{ $json.high > 0 || $json.critical > 0 }}

  7a. Create GitHub Issue (IF True)
     - Title: "ğŸ”´ Security: {{ $json.high + $json.critical }} High/Critical Vulnerabilities"
     - Body: Detailed report with fix commands
     - Labels: ["security", "dependencies"]

  7b. Slack Notification (IF True)
```

#### GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ (.github/workflows/npm-audit.yml)

```yaml
name: NPM Security Audit

on:
  workflow_dispatch:
  schedule:
    - cron: '0 10 * * 1'  # æ¯é€±æœˆæ›œ 10:00 JST

jobs:
  audit:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Run NPM Audit
        id: audit
        run: |
          npm audit --json > audit-results.json || true
          cat audit-results.json

      - name: Parse Results
        id: parse
        run: |
          CRITICAL=$(jq '.metadata.vulnerabilities.critical' audit-results.json)
          HIGH=$(jq '.metadata.vulnerabilities.high' audit-results.json)
          MODERATE=$(jq '.metadata.vulnerabilities.moderate' audit-results.json)

          echo "critical=$CRITICAL" >> $GITHUB_OUTPUT
          echo "high=$HIGH" >> $GITHUB_OUTPUT
          echo "moderate=$MODERATE" >> $GITHUB_OUTPUT

      - name: Create Issue if Vulnerabilities Found
        if: steps.parse.outputs.high > 0 || steps.parse.outputs.critical > 0
        uses: actions/github-script@v6
        with:
          script: |
            const title = `ğŸ”´ Security: ${context.payload.outputs.high + context.payload.outputs.critical} High/Critical Vulnerabilities`;
            const body = `## NPM Audit Results

            - Critical: ${context.payload.outputs.critical}
            - High: ${context.payload.outputs.high}
            - Moderate: ${context.payload.outputs.moderate}

            ### Action Required
            \`\`\`bash
            npm audit fix --force
            \`\`\`

            ### Details
            See workflow run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
            `;

            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: title,
              body: body,
              labels: ['security', 'dependencies']
            });

      - name: Upload Audit Results
        uses: actions/upload-artifact@v3
        with:
          name: audit-results
          path: audit-results.json
```

---

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼3: AdMobåç›Šãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ—¥æ¬¡ï¼‰

### ç›®çš„
æ—¥æ¬¡ã®AdMobåç›Šã‚’è‡ªå‹•å–å¾—ã—ã€Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¨˜éŒ²

### å®Ÿè£…

#### n8nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æˆ

```yaml
Workflow: AdMob Daily Revenue Report
Trigger: Cron (æ¯æ—¥ 10:00 JST)

Nodes:
  1. Schedule Trigger
     - Cron: "0 10 * * *"

  2. Google AdMob API - Get Report
     - Account: pub-5237930968754753
     - Metrics: ESTIMATED_EARNINGS, CLICKS, IMPRESSIONS
     - Date: Yesterday

  3. Function - Calculate Metrics
     - JavaScript:
       ```javascript
       const data = $json;
       const revenue = data.earnings;
       const ctr = (data.clicks / data.impressions) * 100;
       const ecpm = (data.earnings / data.impressions) * 1000;

       return {
         date: new Date().toISOString().split('T')[0],
         revenue: revenue.toFixed(2),
         impressions: data.impressions,
         clicks: data.clicks,
         ctr: ctr.toFixed(2),
         ecpm: ecpm.toFixed(2)
       };
       ```

  4. Google Sheets - Append Row
     - Spreadsheet: "ParkPedia Analytics"
     - Sheet: "AdMob Daily"
     - Values: [date, revenue, impressions, clicks, ctr, ecpm]

  5. IF - Low Revenue Alert
     - Condition: {{ $json.revenue < 100 }}

  6. Slack Notification (IF True)
     - Message: "âš ï¸ AdMobåç›ŠãŒä½ä¸‹ã—ã¦ã„ã¾ã™"
```

#### æ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **AdMob APIæœ‰åŠ¹åŒ–**
   - Google Cloud Console
   - AdMob API ã‚’æœ‰åŠ¹åŒ–
   - OAuth 2.0èªè¨¼æƒ…å ±ã‚’ä½œæˆ

2. **Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä½œæˆ**
   - ã€ŒParkPedia Analyticsã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½œæˆ
   - ã€ŒAdMob Dailyã€ã‚·ãƒ¼ãƒˆã«ä»¥ä¸‹ã®ãƒ˜ãƒƒãƒ€ãƒ¼:
     | Date | Revenue | Impressions | Clicks | CTR | eCPM |

---

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼4: Firebaseåˆ©ç”¨æ–™é‡‘ç›£è¦–ï¼ˆæœˆæ¬¡ï¼‰

### ç›®çš„
æœˆæ¬¡ã®Firebaseåˆ©ç”¨æ–™é‡‘ã‚’å–å¾—ã—ã€äºˆç®—è¶…éã‚’æ¤œçŸ¥

### å®Ÿè£…

#### n8nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æˆ

```yaml
Workflow: Firebase Billing Monitor
Trigger: Cron (æ¯æœˆ1æ—¥ 9:00 JST)

Nodes:
  1. Schedule Trigger
     - Cron: "0 9 1 * *" (æ¯æœˆ1æ—¥ 9æ™‚)

  2. Google Cloud Billing API - Get Costs
     - Project: parkpedia-app
     - Period: Last month

  3. Function - Analyze Costs
     - Calculate total
     - Compare with budget (ä¾‹: 10,000å††)
     - Breakdown by service

  4. Google Sheets - Update Monthly Report

  5. IF - Budget Exceeded
     - Condition: {{ $json.total > 10000 }}

  6. Slack Alert (IF True)
     - Message: "ğŸš¨ Firebaseäºˆç®—è¶…éï¼"
```

---

## ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼5: ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆï¼ˆé€±æ¬¡ï¼‰

### ç›®çš„
é€±æ¬¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆï¼ˆæ–°è¦ç™»éŒ²ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãªã©ï¼‰ã‚’è‡ªå‹•ç”Ÿæˆ

### å®Ÿè£…

#### Firebase Functionsã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```javascript
// functions/weeklyUserStats.js
const admin = require('firebase-admin');
admin.initializeApp();

exports.weeklyUserStats = async () => {
  const db = admin.firestore();
  const now = new Date();
  const oneWeekAgo = new Date(now - 7 * 24 * 60 * 60 * 1000);

  // æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
  const newUsers = await db.collection('users')
    .where('createdAt', '>=', oneWeekAgo)
    .get();

  // æ–°è¦å…¬åœ’æŠ•ç¨¿æ•°
  const newParks = await db.collection('parks')
    .where('createdAt', '>=', oneWeekAgo)
    .get();

  // æ–°è¦ãƒ¬ãƒ“ãƒ¥ãƒ¼æ•°
  const newReviews = await db.collection('reviews')
    .where('createdAt', '>=', oneWeekAgo)
    .get();

  // ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°
  const totalUsers = await db.collection('users').count().get();

  return {
    period: {
      start: oneWeekAgo.toISOString(),
      end: now.toISOString()
    },
    newUsers: newUsers.size,
    newParks: newParks.size,
    newReviews: newReviews.size,
    totalUsers: totalUsers.data().count,
    growthRate: ((newUsers.size / totalUsers.data().count) * 100).toFixed(2)
  };
};
```

#### n8nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```yaml
Workflow: Weekly User Stats
Trigger: Cron (æ¯é€±æœˆæ›œ 9:00)

Nodes:
  1. Schedule Trigger

  2. Firebase Function - Call weeklyUserStats

  3. Format Report

  4. Google Sheets - Update

  5. Slack Summary
```

---

## æ‰‹å‹•å®Ÿæ–½ãŒå¿…è¦ãªã‚¿ã‚¹ã‚¯

### ãªãœæ‰‹å‹•ãŒå¿…è¦ã‹

ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã¯ã€äººé–“ã®åˆ¤æ–­ãƒ»åˆ†æãŒå¿…è¦ãªãŸã‚è‡ªå‹•åŒ–ã«é©ã—ã¦ã„ã¾ã›ã‚“ï¼š

#### 1. ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- **ç†ç”±**: æ–‡è„ˆç†è§£ã¨å€«ç†çš„åˆ¤æ–­ãŒå¿…è¦
- **é »åº¦**: é€±1å›
- **æ‰‹é †**:
  1. Firebase Console > Firestore > `reviews`ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
  2. `reports`ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§é€šå ±ãŒã‚ã£ãŸãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¢ºèª
  3. ä¸é©åˆ‡ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å‰Šé™¤ã¾ãŸã¯ãƒ•ãƒ©ã‚°ä»˜ã‘

#### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒé©ç”¨
- **ç†ç”±**: ç ´å£Šçš„å¤‰æ›´ã®å¯èƒ½æ€§ã€ãƒ†ã‚¹ãƒˆå¿…é ˆ
- **é »åº¦**: æœˆ1å›ã¾ãŸã¯ç·Šæ€¥æ™‚
- **æ‰‹é †**:
  1. `npm audit`å®Ÿè¡Œ
  2. ãƒ‘ãƒƒãƒãƒãƒ¼ãƒˆã‚’ç¢ºèª
  3. `npm update [package]`å®Ÿè¡Œ
  4. ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ
  5. TestFlightã§å‹•ä½œç¢ºèª
  6. æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

#### 3. ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ç­–å®š
- **ç†ç”±**: ãƒ“ã‚¸ãƒã‚¹æˆ¦ç•¥ã¨å¯†æ¥ã«é–¢é€£
- **é »åº¦**: å››åŠæœŸ
- **æ‰‹é †**:
  1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åˆ†æ
  2. ç«¶åˆèª¿æŸ»
  3. æŠ€è¡“çš„è² å‚µã®è©•ä¾¡
  4. å„ªå…ˆé †ä½ä»˜ã‘

---

## å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### ã‚¹ãƒ†ãƒƒãƒ—1: n8nã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨: Dockerï¼‰

```bash
# 1. Dockerã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆï¼‰
# macOS
brew install --cask docker

# 2. n8nã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
docker run -it --rm \
  --name n8n \
  -p 5678:5678 \
  -e GENERIC_TIMEZONE="Asia/Tokyo" \
  -e TZ="Asia/Tokyo" \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n

# 3. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹
# http://localhost:5678

# 4. æ°¸ç¶šåŒ–ã—ã¦èµ·å‹•ï¼ˆæ¨å¥¨ï¼‰
docker run -d --restart unless-stopped \
  --name n8n \
  -p 5678:5678 \
  -e GENERIC_TIMEZONE="Asia/Tokyo" \
  -e TZ="Asia/Tokyo" \
  -v ~/.n8n:/home/node/.n8n \
  n8nio/n8n
```

### ã‚¹ãƒ†ãƒƒãƒ—2: èªè¨¼æƒ…å ±ã®è¿½åŠ 

#### Firebase Admin SDK

1. Firebase Console > Project Settings > Service Accounts
2. ã€ŒGenerate New Private Keyã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
4. n8n > Credentials > Add > Google Service Account
5. JSONã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘

#### Slack Webhook

1. https://api.slack.com/apps
2. ã€ŒCreate New Appã€
3. ã€ŒIncoming Webhooksã€ã‚’æœ‰åŠ¹åŒ–
4. ã€ŒAdd New Webhook to Workspaceã€
5. Webhook URLã‚’ã‚³ãƒ”ãƒ¼
6. n8n > Credentials > Add > Slack Webhook
7. URLã‚’è²¼ã‚Šä»˜ã‘

#### GitHub Personal Access Token

1. GitHub > Settings > Developer settings > Personal access tokens
2. ã€ŒGenerate new token (classic)ã€
3. ã‚¹ã‚³ãƒ¼ãƒ—: `repo`, `workflow`
4. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚³ãƒ”ãƒ¼
5. n8n > Credentials > Add > GitHub
6. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è²¼ã‚Šä»˜ã‘

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

å„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®JSONå®šç¾©ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã§æä¾›ã—ã¾ã™ï¼š

- `n8n-workflows/firebase-error-monitor.json`
- `n8n-workflows/npm-audit.json`
- `n8n-workflows/admob-revenue.json`
- `n8n-workflows/firebase-billing.json`
- `n8n-workflows/weekly-user-stats.json`

n8n UIã§ã€ŒImport from Fileã€ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ã€‚

---

## ã‚³ã‚¹ãƒˆè©¦ç®—

### n8né‹ç”¨ã‚³ã‚¹ãƒˆ

| é …ç›® | æœˆé¡ | å¹´é¡ |
|------|------|------|
| n8n Cloud (Starter) | $20 | $240 |
| **ã¾ãŸã¯** Self-hosted (VPS) | $5-10 | $60-120 |
| Firebase Functions (è¿½åŠ å®Ÿè¡Œ) | $0-5 | $0-60 |
| **åˆè¨ˆ** | $5-25 | $60-300 |

### æ™‚é–“å‰Šæ¸›åŠ¹æœ

| ã‚¿ã‚¹ã‚¯ | æ‰‹å‹•æ™‚é–“/æœˆ | è‡ªå‹•åŒ–å¾Œ | å‰Šæ¸›æ™‚é–“ |
|--------|------------|----------|---------|
| ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç¢ºèª | 2æ™‚é–“ | 0.5æ™‚é–“ | 1.5æ™‚é–“ |
| ä¾å­˜é–¢ä¿‚ç®¡ç† | 1æ™‚é–“ | 0.2æ™‚é–“ | 0.8æ™‚é–“ |
| AdMobãƒ¬ãƒãƒ¼ãƒˆ | 1æ™‚é–“ | 0æ™‚é–“ | 1æ™‚é–“ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ | 1.5æ™‚é–“ | 0.3æ™‚é–“ | 1.2æ™‚é–“ |
| **åˆè¨ˆ** | **5.5æ™‚é–“** | **1æ™‚é–“** | **4.5æ™‚é–“** |

**ROI**: æœˆ4.5æ™‚é–“ã®ç¯€ç´„ = å¹´é–“54æ™‚é–“

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¢ºèª
2. â¬œ n8nã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆDockeræ¨å¥¨ï¼‰
3. â¬œ èªè¨¼æƒ…å ±ã‚’è¿½åŠ ï¼ˆFirebase, Slack, GitHubï¼‰
4. â¬œ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼1ï¼ˆã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ç›£è¦–ï¼‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»ãƒ†ã‚¹ãƒˆ
5. â¬œ GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è¿½åŠ 
6. â¬œ 1é€±é–“é‹ç”¨ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†
7. â¬œ æ®‹ã‚Šã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é †æ¬¡è¿½åŠ 

---

## ã‚µãƒãƒ¼ãƒˆãƒ»è³ªå•

è‡ªå‹•åŒ–å®Ÿè£…ã§ã‚ã‹ã‚‰ãªã„ã“ã¨ãŒã‚ã‚Œã°ã€ä»¥ä¸‹ã‚’ç¢ºèªï¼š

1. **n8nå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: https://docs.n8n.io/
2. **Firebase Admin SDK**: https://firebase.google.com/docs/admin/setup
3. **ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã®Issues**: è³ªå•ã‚’æŠ•ç¨¿ã—ã¦ãã ã•ã„

---

**æœ€çµ‚æ›´æ–°**: 2025-12-04
