# 次回リリース チェックリスト - ParkPedia

このチェックリストは、バージョン1.0.7のAdMob実装経験を基に作成されました。

---

## 📋 リリース前の準備

### 1. コードの変更

- [ ] 機能の実装・修正完了
- [ ] すべての変更をGitにコミット
- [ ] GitHubにプッシュ

### 2. バージョン番号の更新

`app.json` を編集：

```json
{
  "expo": {
    "version": "1.0.X",  // ← 更新
    "ios": {
      "buildNumber": "XX"  // ← 増やす
    }
  }
}
```

- [ ] `version` を更新（例: 1.0.7 → 1.0.8）
- [ ] `buildNumber` を増やす（例: 11 → 12）
- [ ] 変更をコミット

### 3. ネイティブコードの変更がある場合

**以下のいずれかに該当する場合**:
- 新しいネイティブライブラリを追加した
- expo-location、expo-image-pickerなどのexpoプラグインを追加/削除した
- app.jsonのpluginsセクションを変更した
- AdMobなどの広告SDKを追加/変更した

**実行が必要**:
```bash
npx expo prebuild --clean
```

- [ ] ネイティブプロジェクトの再生成（必要な場合のみ）

---

## 🧪 テスト

### 開発環境でのテスト

```bash
# iOS
npx expo run:ios

# Android（実装している場合）
npx expo run:android
```

- [ ] アプリが正常に起動する
- [ ] 主要機能が動作する
- [ ] 広告が表示される（AdMob実装済みの場合）
- [ ] クラッシュしない

### 確認項目

- [ ] ホーム画面が表示される
- [ ] 公園の検索・表示ができる
- [ ] 公園詳細画面が開く
- [ ] レビュー投稿ができる
- [ ] 位置情報が取得できる
- [ ] 画像アップロードができる
- [ ] 広告が表示される（該当する場合）

---

## 🏗️ ビルド

### プロダクションビルドの作成

```bash
eas build --platform ios --profile production
```

**所要時間**: 10〜20分

- [ ] ビルド開始
- [ ] ビルド成功を確認
- [ ] Build IDをメモ

**エラーが出た場合**:
1. エラーメッセージを確認
2. `npx expo prebuild --clean` を試す
3. `package-lock.json` と `node_modules` を削除して `npm install`

---

## 📤 App Store Connectへの提出

### 自動提出

```bash
eas submit --platform ios
```

対話形式で質問に答える：
- [ ] 最新のビルドを選択
- [ ] 提出完了を確認

### 提出後の確認

**App Store Connect（https://appstoreconnect.apple.com/）**:

1. [ ] 「マイApp」→「ParkPedia」→「TestFlight」を開く
2. [ ] 「iOS」タブでビルド番号が表示されることを確認
3. [ ] ステータスが「処理中」になっていることを確認

**待ち時間**: 5〜30分

---

## 🔐 暗号化コンプライアンス

### ビルド処理完了後

App Store Connectで「コンプライアンス待ち」になったら：

1. [ ] ビルド番号をクリック
2. [ ] 「輸出コンプライアンス情報を提供」をクリック
3. [ ] 質問に回答：
   - **「暗号化を使用していますか？」** → **「いいえ」**
4. [ ] 保存

**理由**: app.jsonに`ITSAppUsesNonExemptEncryption: false`を設定済み

---

## 🧪 TestFlightでの確認

### TestFlightアプリでインストール

1. [ ] iPhoneでTestFlightアプリを開く
2. [ ] ParkPediaアプリを探す
3. [ ] 新しいバージョンが表示されることを確認
4. [ ] 「インストール」または「更新」をタップ

### 動作確認

- [ ] アプリが正常に起動する
- [ ] 主要機能が動作する
- [ ] 広告が表示される（本番広告）
- [ ] クラッシュしない

**⚠️ 重要**: 自分の広告は絶対にクリックしないこと！

---

## 📝 App Store Connectでの設定

### プライバシー設定（AdMob実装済みの場合）

**「Appのプライバシー」セクション**:

1. [ ] 「ID」→「デバイスID」を選択
2. [ ] 使用目的:
   - ☑️ サードパーティ広告
   - ☑️ アナリティクス
   - ☑️ 製品のパーソナライズ
3. [ ] 「ユーザにリンクされていますか？」→「いいえ」
4. [ ] 「トラッキングに使用されますか？」→「はい」
5. [ ] 保存

### 年齢制限設定

**「App情報」→「年齢制限」**:

1. [ ] 「編集」をクリック
2. [ ] 「広告」の頻度を選択（通常は「中程度」）
3. [ ] 保存

---

## 🚀 App Storeへの提出

### 新しいバージョンの作成

**「App Store」タブ**:

1. [ ] 左サイドバーで「+」アイコンをクリック
2. [ ] 新しいバージョン番号を入力（例: 1.0.8）
3. [ ] 「作成」をクリック

### バージョン情報の入力

4. [ ] 「新機能」を入力（リリースノート）
5. [ ] スクリーンショットを確認（変更がある場合のみ更新）
6. [ ] ビルドを選択（最新のビルド番号を選択）

### 審査情報の確認

7. [ ] 連絡先情報が正しいか確認
8. [ ] デモアカウント情報（必要な場合）
9. [ ] メモ（審査担当者向け）

### 提出

10. [ ] 「審査に提出」をクリック
11. [ ] 確認ダイアログで「送信」をクリック

---

## ⏰ 審査待ち

### タイムライン

- **提出後**: 「審査待ち」
- **24〜48時間後**: 審査開始 →「審査中」
- **1〜3日後**: 審査結果
  - ✅ 承認 →「配信準備完了」→「App Storeで入手可能」
  - ❌ 却下 → 理由を確認 → 修正 → 再提出

### 審査中にできること

- [ ] AdMob Consoleで広告リクエストを確認（24時間後）
- [ ] app-ads.txtのステータスを確認
- [ ] TestFlightでのテストを継続
- [ ] 次のバージョンの開発を開始

---

## 📊 リリース後の確認

### App Store

- [ ] App Storeでアプリを検索
- [ ] 新しいバージョンが表示されることを確認
- [ ] ダウンロード・インストールして動作確認

### AdMob（広告実装済みの場合）

**24〜48時間後**:

1. [ ] AdMob Console（https://apps.admob.com/）にログイン
2. [ ] 「アプリ」→「ParkPedia (iOS)」を開く
3. [ ] app-ads.txtステータスが「✅ 認証済み」になっているか確認
4. [ ] 広告リクエスト数を確認
5. [ ] 収益が発生し始めているか確認

---

## 🔧 トラブルシューティング

### ビルドが失敗する

**原因と対策**:
1. **依存関係の問題**
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```

2. **ネイティブコードの問題**
   ```bash
   npx expo prebuild --clean
   ```

3. **キャッシュの問題**
   ```bash
   npx expo start --clear
   ```

### TestFlightに表示されない

**確認事項**:
1. [ ] `eas submit` が成功したか確認
2. [ ] App Store Connectで「処理中」になっているか確認
3. [ ] 5〜30分待つ
4. [ ] 暗号化コンプライアンスの質問に回答したか確認

### 広告が表示されない

**確認事項**:
1. [ ] `adConfig.js` で `AD_ENABLED = true` になっているか
2. [ ] 広告ユニットIDが正しいか
3. [ ] app-ads.txtがルートドメインに配置されているか
4. [ ] 24〜48時間待つ（初回は検証に時間がかかる）

---

## 📝 リリースノートのテンプレート

```
バージョン X.X.X の新機能:

- [機能追加] 〇〇機能を追加しました
- [改善] △△の使いやすさを向上しました
- [修正] □□の不具合を修正しました
- [その他] パフォーマンスの改善とバグ修正

いつもParkPediaをご利用いただきありがとうございます！
```

---

## ✅ 完了！

すべてのチェックボックスにチェックが入ったら、リリース完了です！

お疲れ様でした！🎉

---

**最終更新**: 2025年12月2日  
**バージョン**: 1.0.7の経験を基に作成
