# 管理者ページ 詳細ガイド

## 📋 目次

1. [管理者ページとは](#管理者ページとは)
2. [最初の設定（初回のみ）](#最初の設定初回のみ)
3. [管理者ページへのアクセス方法](#管理者ページへのアクセス方法)
4. [各機能の使い方](#各機能の使い方)
5. [よくある質問](#よくある質問)

---

## 🎯 管理者ページとは

管理者ページは、**あなたと妻でアプリを管理するための専用画面**です。

### できること
- ✅ ユーザーから報告されたレビューを確認・対応
- ✅ 不適切な公園を削除
- ✅ 不適切なレビューを削除
- ✅ すべての公園とレビューを一覧表示

### 管理者の人数
- **2人**: あなたと妻
- 将来的に他の管理者を追加することも可能

---

## 🔧 最初の設定（初回のみ）

### ステップ1: あなたのUIDを確認

#### 方法1: Firebase Consoleで確認（推奨）
1. **Firebase Consoleを開く**
   - https://console.firebase.google.com/project/parkpedia-app/authentication/users
   - ログインが必要な場合は、Googleアカウントでログイン

2. **Authentication > Users**を開く
   - 左メニューから「Authentication」をクリック
   - 「Users」タブをクリック

3. **あなたのアカウントを選択**
   - ユーザー一覧から、あなたのメールアドレスを選択

4. **UIDをコピー**
   - 「UID」フィールドをコピー
   - 例: `4lg1g6MmpdMJQjya3kRnkW5FADz1`

#### 方法2: アプリで確認（開発者向け）
- アプリのデバッグログで `auth.currentUser.uid` を確認

### ステップ2: 妻のUIDを確認

同じ手順で、妻のUIDも確認してください。

### ステップ3: `admins`コレクションを作成

1. **Firebase Consoleを開く**
   - https://console.firebase.google.com/project/parkpedia-app/firestore/data

2. **Firestore Databaseを開く**
   - 左メニューから「Firestore Database」をクリック

3. **「コレクションを開始」をクリック**
   - 画面中央の「コレクションを開始」ボタンをクリック

4. **コレクションIDを入力**
   - コレクションID: `admins` を入力
   - 「次へ」をクリック

5. **最初のドキュメント（あなた）を作成**
   - **ドキュメントID**: あなたのUID（ステップ1でコピーした値）
     - 例: `4lg1g6MmpdMJQjya3kRnkW5FADz1`
   - **フィールドを追加**:
     - フィールド: `userId`
     - タイプ: `string`（文字列）
     - 値: あなたのUID（ドキュメントIDと同じ値）
   - 「保存」をクリック

6. **2つ目のドキュメント（妻）を作成**
   - 同じコレクション内で「ドキュメントを追加」をクリック
   - **ドキュメントID**: 妻のUID
   - **フィールドを追加**:
     - フィールド: `userId`
     - タイプ: `string`（文字列）
     - 値: 妻のUID（ドキュメントIDと同じ値）
   - 「保存」をクリック

### ステップ4: 確認

`admins`コレクションに、あなたと妻の2つのドキュメントが作成されていることを確認してください。

---

## 🚪 管理者ページへのアクセス方法

### ステップ1: アプリでログイン
1. アプリを開く
2. ログイン画面でログイン（あなたのアカウントで）

### ステップ2: マイページを開く
1. ホーム画面の下部にある「マイページ」タブをタップ
2. または、ヘッダーの「マイページ」ボタンをタップ

### ステップ3: 管理者ページボタンを確認
- マイページの上部に「🔧 管理者ページ」ボタンが表示されます
- **表示されない場合**: 管理者権限が設定されていません（ステップ3を確認）

### ステップ4: 管理者ページを開く
- 「🔧 管理者ページ」ボタンをタップ
- 管理者ページが開きます

---

## 📱 管理者ページの使い方

### 画面の構成

管理者ページは、**3つのタブ**で構成されています：

```
┌─────────────────────────────────┐
│  [レポート] [公園] [レビュー]    │  ← タブ
├─────────────────────────────────┤
│                                  │
│  選択したタブの内容が表示される  │
│                                  │
└─────────────────────────────────┘
```

### タブの説明

1. **レポート** (デフォルト)
   - ユーザーから報告されたレビューを管理
   - 対応待ちのレポート数が表示されます
   - 例: `レポート (3)` → 対応待ちが3件

2. **公園**
   - すべての公園を一覧表示
   - 公園の総数が表示されます
   - 例: `公園 (15)` → 公園が15件

3. **レビュー**
   - すべてのレビューを一覧表示
   - レビューの総数が表示されます
   - 例: `レビュー (42)` → レビューが42件

---

## 📝 レポート管理（最も重要）

### レポートとは

ユーザーが不適切なレビューを報告した場合、その情報がレポートとして管理者ページに表示されます。

### レポートの状態

- **対応待ち** (pending): 🟡 新しく報告されたレビュー（対応が必要）
- **解決済み** (resolved): 🟢 対応が完了したレポート
- **却下** (dismissed): ⚪ 問題がないと判断したレポート

### レポートカードの見方

各レポートカードには以下の情報が表示されます：

```
┌─────────────────────────────────┐
│ 🟡 対応待ち    2025/12/7         │  ← 状態と日付
├─────────────────────────────────┤
│ 公園: 小林市総合運動公園         │
│ 理由: 不適切なコンテンツ          │
├─────────────────────────────────┤
│ レビュー内容:                    │
│ "高台で景色がとても綺麗です..."   │
│ ⭐⭐⭐⭐☆                        │  ← 評価
├─────────────────────────────────┤
│ [解決済み] [却下] [レビュー削除] │  ← 操作ボタン
└─────────────────────────────────┘
```

### 操作の使い方

#### 1. 「解決済み」ボタン
- **いつ使う**: 不適切なコンテンツを削除した場合
- **操作**: ボタンをタップ → 確認ダイアログで「解決済みにする」を選択
- **結果**: レポートの状態が「解決済み」に変更されます

#### 2. 「却下」ボタン
- **いつ使う**: 報告内容に問題がないと判断した場合
- **操作**: ボタンをタップ → 確認ダイアログで「却下する」を選択
- **結果**: レポートの状態が「却下」に変更されます

#### 3. 「レビュー削除」ボタン
- **いつ使う**: 不適切なレビューを削除する場合
- **操作**: ボタンをタップ → 確認ダイアログで「削除」を選択
- **結果**: 
  - レビューが削除されます
  - 公園の評価が自動的に再計算されます
  - レポートも更新されます

### レポート対応の流れ（推奨）

1. **レポートを確認**
   - レポートタブを開く
   - 対応待ちのレポートを確認

2. **レビュー内容を確認**
   - レビュー内容、評価、公園名を確認
   - 報告理由を確認

3. **対応を決定**
   - **不適切な内容**: 「レビュー削除」ボタンをタップ
   - **問題なし**: 「却下」ボタンをタップ

4. **対応完了**
   - 「解決済み」ボタンをタップ（レビューを削除した場合）

---

## 🏞️ 公園管理

### 公園一覧の見方

公園タブを開くと、すべての公園が表示されます。

各公園カードには以下の情報が表示されます：

```
┌─────────────────────────────────┐
│ 小林市総合運動公園                │  ← 公園名
│ 宮崎県小林市南西方 2087番地       │  ← 住所
│ 評価: 4.0 (1件)                  │  ← 評価とレビュー数
│ [削除]                           │  ← 削除ボタン
└─────────────────────────────────┘
```

### 公園を削除する方法

1. **公園タブを開く**
   - 管理者ページの上部で「公園」タブをタップ

2. **削除したい公園を探す**
   - 一覧から削除したい公園を探す

3. **削除ボタンをタップ**
   - 公園カードの「削除」ボタンをタップ

4. **確認ダイアログで確認**
   - 「この公園を削除しますか？関連するレビューもすべて削除されます。この操作は取り消せません。」
   - 「削除」をタップ

5. **削除完了**
   - 公園が削除されます
   - 関連するすべてのレビューも削除されます

### ⚠️ 注意事項

- **取り消し不可**: 削除した公園は復元できません
- **関連データも削除**: 公園を削除すると、関連するすべてのレビューも削除されます
- **慎重に操作**: 削除する前に、本当に削除してよいか確認してください

---

## ⭐ レビュー管理

### レビュー一覧の見方

レビュータブを開くと、すべてのレビューが表示されます。

各レビューカードには以下の情報が表示されます：

```
┌─────────────────────────────────┐
│ 小林市総合運動公園                │  ← 公園名
│ ⭐⭐⭐⭐☆                        │  ← 評価
│ 高台で景色がとても綺麗です。       │  ← コメント
│ 遊具が新しく子供も遊びやすいです。│
│ - kamui00002                     │  ← ユーザー名
│ [削除]                           │  ← 削除ボタン
└─────────────────────────────────┘
```

### レビューを削除する方法

1. **レビュータブを開く**
   - 管理者ページの上部で「レビュー」タブをタップ

2. **削除したいレビューを探す**
   - 一覧から削除したいレビューを探す

3. **削除ボタンをタップ**
   - レビューカードの「削除」ボタンをタップ

4. **確認ダイアログで確認**
   - 「このレビューを削除しますか？この操作は取り消せません。」
   - 「削除」をタップ

5. **削除完了**
   - レビューが削除されます
   - 公園の評価が自動的に再計算されます

### ⚠️ 注意事項

- **取り消し不可**: 削除したレビューは復元できません
- **評価の自動更新**: レビューを削除すると、公園の評価が自動的に再計算されます
- **慎重に操作**: 削除する前に、本当に削除してよいか確認してください

---

## 🔍 よくある質問

### Q1: 「管理者ページ」ボタンが表示されない

**原因**: 管理者権限が設定されていません

**解決方法**:
1. Firebase Consoleで`admins`コレクションを確認
2. あなたのUIDがドキュメントIDとして登録されているか確認
3. `userId`フィールドが正しく設定されているか確認
4. アプリを再起動

### Q2: レポートが表示されない

**原因**: 
- レポートが存在しない
- 権限エラー

**解決方法**:
1. Firebase Consoleで`reports`コレクションを確認
2. レポートが存在するか確認
3. Firestoreルールが正しくデプロイされているか確認
4. アプリを再起動

### Q3: 削除操作が失敗する

**原因**: 
- 権限エラー
- ネットワークエラー

**解決方法**:
1. インターネット接続を確認
2. Firestoreルールが正しくデプロイされているか確認
3. アプリを再起動
4. しばらく待ってから再度試す

### Q4: 妻も管理者にしたい

**解決方法**:
1. Firebase Consoleで妻のUIDを確認
2. `admins`コレクションに新しいドキュメントを追加
3. ドキュメントID: 妻のUID
4. `userId`フィールド: 妻のUID
5. 妻のアプリを再起動

### Q5: 他の人も管理者にしたい

**解決方法**:
1. あなたまたは妻が管理者ページにアクセス
2. （将来的に実装予定）管理者ページから他のユーザーを追加
3. 現在は、Firebase Consoleから手動で追加する必要があります

---

## 📋 管理者権限の設定（再確認）

### 設定の確認方法

1. **Firebase Consoleを開く**
   - https://console.firebase.google.com/project/parkpedia-app/firestore/data

2. **`admins`コレクションを開く**
   - 左メニューから`admins`コレクションを選択

3. **ドキュメントを確認**
   - あなたと妻のUIDがドキュメントIDとして登録されているか確認
   - 各ドキュメントに`userId`フィールドが存在するか確認

### 設定例

```
コレクション: admins

ドキュメント1:
  - ドキュメントID: 4lg1g6MmpdMJQjya3kRnkW5FADz1 (あなたのUID)
  - フィールド:
    - userId: "4lg1g6MmpdMJQjya3kRnkW5FADz1"

ドキュメント2:
  - ドキュメントID: [妻のUID]
  - フィールド:
    - userId: [妻のUID]
```

---

## 🎯 日常的な使い方

### 毎日のチェック（推奨）

1. **レポートを確認**
   - 管理者ページを開く
   - レポートタブで対応待ちのレポートを確認
   - 必要に応じて対応

2. **不適切なコンテンツを削除**
   - レポートから不適切なレビューを削除
   - または、公園・レビュータブから直接削除

3. **定期的な確認**
   - 週に1回程度、公園とレビューを確認
   - 不適切なコンテンツがないか確認

---

## ⚠️ 重要な注意事項

### 削除操作について

- **取り消し不可**: 削除した公園やレビューは復元できません
- **関連データ**: 公園を削除すると、関連するすべてのレビューも削除されます
- **評価の更新**: レビューを削除すると、公園の評価が自動的に再計算されます

### 管理者権限について

- **最初の管理者**: Firebase Consoleから手動で追加する必要があります
- **追加の管理者**: 現在はFirebase Consoleから手動で追加する必要があります
- **権限の確認**: 管理者権限がない場合、管理者ページにアクセスできません

---

## 📞 トラブルシューティング

### 問題: 管理者ページにアクセスできない

**確認事項**:
1. Firebase Consoleで`admins`コレクションを確認
2. あなたのUIDが登録されているか確認
3. アプリを再起動
4. ログアウトして再度ログイン

### 問題: レポートが表示されない

**確認事項**:
1. Firebase Consoleで`reports`コレクションを確認
2. レポートが存在するか確認
3. Firestoreルールが正しくデプロイされているか確認

### 問題: 削除操作が失敗する

**確認事項**:
1. インターネット接続を確認
2. Firestoreルールが正しくデプロイされているか確認
3. アプリを再起動

---

## 📚 関連ドキュメント

- `ADMIN_SETUP_GUIDE.md`: セットアップの詳細
- `UID_EXPLANATION.md`: UIDについての説明
- `firestore.rules`: Firestoreセキュリティルール

---

## ✅ チェックリスト

### 初回設定
- [ ] あなたのUIDを確認
- [ ] 妻のUIDを確認
- [ ] `admins`コレクションを作成
- [ ] あなたのドキュメントを追加
- [ ] 妻のドキュメントを追加
- [ ] アプリで「管理者ページ」ボタンが表示されることを確認

### 日常的な使用
- [ ] レポートを確認
- [ ] 不適切なコンテンツを削除
- [ ] 定期的に公園とレビューを確認

---

このガイドで、管理者ページの使い方がわかりましたか？不明な点があれば、お知らせください。

